---
layout: post
title: Easily deploying test environments from CI builds with Travis, AWS and Slack
author: tatut
excerpt: Easy setup of test environments is important for feature branch based development. This post shows how to automatically deploy a new test environment with a simple chat interface.
tags:
- CI
- AWS
- cloud
- slack
---

Our project uses a git flow process: a new branch is created for each new feature. The feature is
developed in its entirety in the branch. This includes tests, database migrations and the code
itself. When the feature is ready, a GitHub pull request is made and another developer tests and
reviews the code.

We wanted to make testing another branch easy for developers. Developers will most likely have
their own branch in progress on their local machine and we wanted a system where developers
don't need to hop between their own branch and another one. Initially we made six development
test machines where the initial developer would deploy a new version for testing but this was
cumbersome as it needed manual deployment work and a reservation system to reserve a test
machine for your branch. Also the machines were idling most of the time.

Here's a TL;DR high level view:

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="417.1" height="610"><style xmlns="http://www.w3.org/1999/xhtml"></style><defs/><g transform="translate(0,0)"><g><rect fill="#FFFFFF" stroke="none" x="0" y="0" width="417.1" height="610"/></g><g transform="translate(0,0) matrix(1,0,0,1,230.89999999999998,35)"><g><g transform="translate(0,0) scale(0.7,0.3)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(1.4285714285714286,3.3333333333333335)"><path fill="none" stroke="none" d="M 0 0 L 70 0 Q 70 0 70 0 L 70 30 Q 70 30 70 30 L 0 30 Q 0 30 0 30 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 70 0 Q 70 0 70 0 L 70 30 Q 70 30 70 30 L 0 30 Q 0 30 0 30 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,240,43)"><g transform="translate(14,0) matrix(1,0,0,1,0,0) translate(-14,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="52" height="14" fill-opacity="0"/></g></g><g transform="translate(14,0) matrix(1,0,0,1,0,0) translate(-14,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="52" height="14" fill-opacity="0"/></g></g><g transform="translate(14,0) matrix(1,0,0,1,0,0) translate(-14,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="7" y="0" width="38" height="14" fill-opacity="0"/></g></g><g transform="translate(14,0) matrix(1,0,0,1,0,0) translate(-14,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="7" y="0" width="38" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="7" y="12">GitHub</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,47.5,10)"><g><g transform="translate(0,0) translate(0,0) scale(1.47,1.4)"><g><path fill="#FFFFFF" stroke="none" d="M 20 5 A 5 5 0 1 0 19.99999750000021 5.004999999166668 Z"/><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 0 C 26.109292545000002 0 29.4 3.1340071000000003 29.4 7 C 29.4 10.8659929 26.109292545000002 14 22.05 14 C 17.990707455 14 14.700000000000001 10.8659929 14.700000000000001 7 C 14.700000000000001 3.1340071000000003 17.990707455 0 22.05 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 14 L 22.05 42" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 42 L 14.7 70" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 42 L 29.4 70" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 42 L 29.4 70" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 0 21 L 44.1 21" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,40,82)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="59" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="59" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="53" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="53" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">developer</text></g></g><g transform="matrix(1,0,0,1,87.1,15)"><image width="173" height="60" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK0AAAA8CAYAAAAUlTqlAAAB7ElEQVR4Xu3Y4UnEUBBF4dkKtAQ7swTtQK1A7cBS1s4ksKLIukP+bO6QLxBYmEDuO/fweNlDuRAYRuAwLK+4CBRpSTCOAGnHVSYwaTkwjgBpx1UmMGk5MI4AacdVJjBpOTCOAGnHVSYwaTkwjgBpx1UmMGk5MI4AacdVJjBpOTCOAGnHVSYwaTkwjgBpx1UmMGk5MI4AacdVJjBpOTCOAGnHVSYwaTkwjgBpx1UmMGk5MI4AacdVdpXAd1X1WlXvVXW8yhtXvIS0K2Dt6NGPqro/rXeR9iVJXtLuyMQVS72tqsfTfZMmL2lXNLnDRyPlPSftc1U97bAgS15HYLNjA2nXFeXpHwKfVbVscFf/UHM8oOElAsvx4OF0tl1+L9dmsn4HJS1pzxGIlJW0ZL1E4Pd3zeY769+gdlry/rfTLv/Vvm1xZu0qIW1HyDyOAGnjKhGoI0DajpB5HAHSxlUiUEeAtB0h8zgCpI2rRKCOAGk7QuZxBEgbV4lAHQHSdoTM4wiQNq4SgToCpO0ImccRIG1cJQJ1BEjbETKPI0DauEoE6giQtiNkHkeAtHGVCNQRIG1HyDyOAGnjKhGoI0DajpB5HAHSxlUiUEeAtB0h8zgCpI2rRKCOAGk7QuZxBEgbV4lAHQHSdoTM4wh8AaO7HD3igH4dAAAAAElFTkSuQmCC" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,128,31)"><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 0 0 L 63 0 L 63 28 L 0 28 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="63" height="28"/></g></g><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 0 0 L 63 0 L 63 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="63" height="14" fill-opacity="0"/></g></g><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 3 0 L 60 0 L 60 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="57" height="14" fill-opacity="0"/></g></g><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 3 0 L 60 0 L 60 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="57" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">Push</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="34" y="12">code</text></g><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 0 14 L 63 14 L 63 28 L 0 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="63" height="14" fill-opacity="0"/></g></g><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 4 14 L 22 14 L 22 28 L 4 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="4" y="14" width="18" height="14" fill-opacity="0"/></g></g><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 4 14 L 22 14 L 22 28 L 4 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="4" y="14" width="18" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="4" y="26">for</text></g><g transform="translate(36,56) matrix(1,0,0,1,0,0) translate(-36,-56)"><path fill="none" stroke="none" d="M 22 14 L 59 14 L 59 28 L 22 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="22" y="14" width="37" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="22" y="26">branch</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,230.89999999999998,80)"><g><g transform="translate(0,0) scale(0.7,0.4)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(1.4285714285714286,2.5)"><path fill="none" stroke="none" d="M 0 0 L 70 0 Q 70 0 70 0 L 70 40 Q 70 40 70 40 L 0 40 Q 0 40 0 40 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 70 0 Q 70 0 70 0 L 70 40 Q 70 40 70 40 L 0 40 Q 0 40 0 40 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,240,93)"><g transform="translate(4,0) matrix(1,0,0,1,0,0) translate(-4,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="52" height="14" fill-opacity="0"/></g></g><g transform="translate(4,0) matrix(1,0,0,1,0,0) translate(-4,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="52" height="14" fill-opacity="0"/></g></g><g transform="translate(4,0) matrix(1,0,0,1,0,0) translate(-4,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="2" y="0" width="48" height="14" fill-opacity="0"/></g></g><g transform="translate(4,0) matrix(1,0,0,1,0,0) translate(-4,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="2" y="0" width="48" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="2" y="12">Travis</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="38" y="12">CI</text></g></g><g transform="matrix(1,0,0,1,270.9,45.5)"><image width="74" height="84" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEoAAABUCAYAAAAlDKGaAAACnElEQVR4Xu3b0VHUUBjF8UMF0gF0oFYAViAdiBWoFQAdaAVaAh2gb/CEdiAdwJtvOme5l8mShD07sjfZmX9mdmCWA8n+9iQbZu63I7ZIYCdKERJQYQmmhDoJj3ETsVtJPyXdSPqd7GBKqL/JATbIGOqbpC+SDDi4TQl12gBhaBe7kl5J2pe01wkY6b2k86FfmhJqIqfebj9K8pv2ovzEWG7Y0gbUPYdbZpy3Red1uYY9YAG1XBxf4F9K+i7pTfdHQC1DHUq6GGoVUP0rpU/Bd5LOyrVrkQCqD+ULu+/xfkhyw4Aa+ditp5+vV76oAzUC5Xus68c+nHrDWvW/hgcfoIAaObGyp2lU5iSggAoFwhiNAioUCGM0CqhQIIzRKKBCgTBGo4AKBcIYjQIqFAhjNAqoUCCM0SigQoEwRqOACgXCGI0CKhQIYzQKqFAgjNEooEKBMEajgAoFwhiNAioUCGKsjwqQHKkr7n6VhfuLX2N9VF+PNZxho7ZyVbCvF1502mrbunXmPmAvYfZXTxB4kqDF5kWufnOWlk7P8RrVBfLx3UnyUE9viOeZ1TwL81XSUfm7s52FGQL6LMmP0Rm6Z8L6UCYUjOVtltNVBvI76dk5b38kXZaHv9/E1p3Xq/ut7T2e47xe/RjeBMY6f9Pjsj61n2zv1PdRbpQPsk5i1kZdlXat84LXydaZYo/Jzn6muPvCDOaGHZQn/UL8Dj8557uOzP9mp27U4+MfAvvU4FNvpePcoOoBd8Fa3keNgs0Vqh5w6zvzrYVaeUq0Csy9Ua0cVu4HqJVE9wGggAoFwhiNAioUCGM0CqhQIIzRKKBCgTBGo4AKBcIYjQIqFAhjNAqoUCCM0SigQoEwRqOACgXCGI0CKhQIYzQqhPoHwZ5vVQrnTcQAAAAASUVORK5CYII=" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,327,60)"><g transform="translate(50,42) matrix(1,0,0,1,0,0) translate(-50,-42)"><path fill="none" stroke="none" d="M 0 0 L 69 0 L 69 28 L 0 28 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="69" height="28"/></g></g><g transform="translate(50,42) matrix(1,0,0,1,0,0) translate(-50,-42)"><path fill="none" stroke="none" d="M 0 0 L 69 0 L 69 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="69" height="14" fill-opacity="0"/></g></g><g transform="translate(50,42) matrix(1,0,0,1,0,0) translate(-50,-42)"><path fill="none" stroke="none" d="M 3 0 L 66 0 L 66 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="63" height="14" fill-opacity="0"/></g></g><g transform="translate(50,42) matrix(1,0,0,1,0,0) translate(-50,-42)"><path fill="none" stroke="none" d="M 3 0 L 66 0 L 66 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="63" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">Trigger</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="44" y="12">new</text></g><g transform="translate(50,42) matrix(1,0,0,1,0,0) translate(-50,-42)"><path fill="none" stroke="none" d="M 0 14 L 69 14 L 69 28 L 0 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="69" height="14" fill-opacity="0"/></g></g><g transform="translate(50,42) matrix(1,0,0,1,0,0) translate(-50,-42)"><path fill="none" stroke="none" d="M 22 14 L 47 14 L 47 28 L 22 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="22" y="14" width="25" height="14" fill-opacity="0"/></g></g><g transform="translate(50,42) matrix(1,0,0,1,0,0) translate(-50,-42)"><path fill="none" stroke="none" d="M 22 14 L 47 14 L 47 28 L 22 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="22" y="14" width="25" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="22" y="26">build</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,300.9,230)"><g><g transform="translate(0,0) scale(0.9,0.4)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(1.1111111111111112,2.5)"><path fill="none" stroke="none" d="M 0 0 L 90 0 Q 90 0 90 0 L 90 40 Q 90 40 90 40 L 0 40 Q 0 40 0 40 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 90 0 Q 90 0 90 0 L 90 40 Q 90 40 90 40 L 0 40 Q 0 40 0 40 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,311,236)"><g transform="translate(94,42) matrix(1,0,0,1,0,0) translate(-94,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="28" fill-opacity="0"/></g></g><g transform="translate(94,42) matrix(1,0,0,1,0,0) translate(-94,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(94,42) matrix(1,0,0,1,0,0) translate(-94,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="21" y="0" width="29" height="14" fill-opacity="0"/></g></g><g transform="translate(94,42) matrix(1,0,0,1,0,0) translate(-94,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="21" y="0" width="29" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="21" y="12">Slack</text></g><g transform="translate(94,42) matrix(1,0,0,1,0,0) translate(-94,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(94,42) matrix(1,0,0,1,0,0) translate(-94,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="26" y="14" width="20" height="14" fill-opacity="0"/></g></g><g transform="translate(94,42) matrix(1,0,0,1,0,0) translate(-94,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="26" y="14" width="20" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="26" y="26">app</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,10,160)"><g><g transform="translate(0,0) scale(0.75,0.75)"><g><g transform="scale(1.3333333333333333,1.3333333333333333)"><path fill="#FFFFFF" stroke="none" d="M 75 0 L 75 65.625 Q 75 75 37.5 75 Q 0 75 0 65.625 L 0 0 Q 0 -9.375 37.5 -9.375 Q 75 -9.375 75 0 Q 75 9.375 37.5 9.375 Q 0 9.375 0 0"/><path fill="none" stroke="#333333" d="M 75 0 M 75 0 L 75 65.625 Q 75 75 37.5 75 Q 0 75 0 65.625 L 0 0 Q 0 -9.375 37.5 -9.375 Q 75 -9.375 75 0 Q 75 9.375 37.5 9.375 Q 0 9.375 0 0" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,20,184)"><g transform="translate(54,42) matrix(1,0,0,1,0,0) translate(-54,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="56" height="28" fill-opacity="0"/></g></g><g transform="translate(54,42) matrix(1,0,0,1,0,0) translate(-54,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="56" height="14" fill-opacity="0"/></g></g><g transform="translate(54,42) matrix(1,0,0,1,0,0) translate(-54,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="6" y="0" width="44" height="14" fill-opacity="0"/></g></g><g transform="translate(54,42) matrix(1,0,0,1,0,0) translate(-54,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="6" y="0" width="44" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="6" y="12">Amazon</text></g><g transform="translate(54,42) matrix(1,0,0,1,0,0) translate(-54,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="56" height="14" fill-opacity="0"/></g></g><g transform="translate(54,42) matrix(1,0,0,1,0,0) translate(-54,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="21" y="14" width="14" height="14" fill-opacity="0"/></g></g><g transform="translate(54,42) matrix(1,0,0,1,0,0) translate(-54,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="21" y="14" width="14" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="21" y="26">S3</text></g></g><g transform="matrix(1,0,0,1,55,95.5)"><image width="180" height="132" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAACECAYAAAA5twGfAAAFnElEQVR4Xu2ZgY0URxQFHxngCEwGJgNwBnYGEAFkYIjAEIEdAo4AHAEQgXEGEIGtlnel80mWZ4vbt7PdNdLpDmneTP96db1zw714SGAiAvcmmsVRJBCFVoKpCCj0ddb5IMm3SR5f5/LvdNUvb15Noe+U7Vkvdj/JsyRPkgyhPf4h8C+HFfo6tPghyS9JhtTH42OSz0neXccIZ1vlC3fos7E9y4XHjjxkHsefSZ4neXOWO01wUXfofZf4MMn7wxLHs+Krw66871VfcHUKfUH4G2799vCH329JxmOHx/8QUOj9KjLeYAyhvyQZO/Wn/S51PytT6P10cXsl4/FivNV4fXhu3u9Kd7Qyhd5RGbeWMt5ePEryNMmv+13mvlam0Pvq4+Zq/jr843tfzW0vSaG3s2qfeRT6G99sbEev0NtZtc88Cm1HJ5AX1gmwyqcqNACu0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaKaLQALRCA2iliEID0AoNoJUiCg1AKzSAVoooNACt0ABaIfIgyR+H+9jRCcCFdQKs4qmPk7xN8nuS8bPHRgIKvRFU+bTnSX5W6NOpK/TpzBqJF0l+SvI6yZDbYyMBhd4Iqnja/cPz8/j+Y5I3xXtf/a32LPR4dnyW5GmSz1dPevsArw5zf0kypPY4gcAehR4ij4/b4x9DL5OMj+AVjodJ3h8GXWnuO+t2T0LfFnnsUGO3Gl+z79BjJx6fRsdf3I9JhtweJxLYg9ArijwE/i7JeN88vp4cvo/6hsyDyey/xCequu30Swp9W+RtK573rOMn0iqPV2dp8tJCj/IenWWy/V90CPwhyack7w5vM9yVv7K3Swp9XPrYqW+KPUodz83jHawFf2XBq8X3ILRir2bdGefdk9D/Jbavr84owGyX3qPQN8Ue/+073gD46DGbeWeaZ89Cn2lkLzszAYWeud0FZ1PoBUufeWSFnrndBWdT6AVLn3lkhZ653QVnU+gFS595ZIWeud0FZ1PoBUufeWSFnrndBWdT6AVLn3lkhZ653QVnU+gFS595ZIWeud0FZ1PoBUufeWSFnrndBWdT6AVLn3lkhZ653QVnU+gFS595ZIWeud0FZ1PoBUufeWSFnrndBWdT6AVLn3lkhZ653QVnU+gFS5955L8BL3uahZ7q8LkAAAAASUVORK5CYII=" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,127,129)"><g transform="translate(28,42) matrix(1,0,0,1,0,0) translate(-28,-42)"><path fill="none" stroke="none" d="M 0 0 L 63 0 L 63 28 L 0 28 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="63" height="28"/></g></g><g transform="translate(28,42) matrix(1,0,0,1,0,0) translate(-28,-42)"><path fill="none" stroke="none" d="M 0 0 L 63 0 L 63 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="63" height="14" fill-opacity="0"/></g></g><g transform="translate(28,42) matrix(1,0,0,1,0,0) translate(-28,-42)"><path fill="none" stroke="none" d="M 3 0 L 60 0 L 60 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="57" height="14" fill-opacity="0"/></g></g><g transform="translate(28,42) matrix(1,0,0,1,0,0) translate(-28,-42)"><path fill="none" stroke="none" d="M 3 0 L 60 0 L 60 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="57" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">Store</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="35" y="12">build</text></g><g transform="translate(28,42) matrix(1,0,0,1,0,0) translate(-28,-42)"><path fill="none" stroke="none" d="M 0 14 L 63 14 L 63 28 L 0 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="63" height="14" fill-opacity="0"/></g></g><g transform="translate(28,42) matrix(1,0,0,1,0,0) translate(-28,-42)"><path fill="none" stroke="none" d="M 11 14 L 53 14 L 53 28 L 11 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="11" y="14" width="42" height="14" fill-opacity="0"/></g></g><g transform="translate(28,42) matrix(1,0,0,1,0,0) translate(-28,-42)"><path fill="none" stroke="none" d="M 11 14 L 53 14 L 53 28 L 11 28 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="11" y="14" width="42" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="11" y="26">artifacts</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,208.85,160)"><g><g transform="translate(0,0) translate(0,0) scale(1.47,1.4)"><g><path fill="#FFFFFF" stroke="none" d="M 20 5 A 5 5 0 1 0 19.99999750000021 5.004999999166668 Z"/><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 0 C 26.109292545000002 0 29.4 3.1340071000000003 29.4 7 C 29.4 10.8659929 26.109292545000002 14 22.05 14 C 17.990707455 14 14.700000000000001 10.8659929 14.700000000000001 7 C 14.700000000000001 3.1340071000000003 17.990707455 0 22.05 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 14 L 22.05 42" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 42 L 14.7 70" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 42 L 29.4 70" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 22.05 42 L 29.4 70" stroke-miterlimit="10" stroke-width="2"/></g></g><g><g transform="scale(0.6802721088435374,0.7142857142857143)"><path fill="none" stroke="#000000" d="M 0 21 L 44.1 21" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,212,232)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="36" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="36" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="30" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="30" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">tester</text></g></g><g transform="matrix(1,0,0,1,248.45,190.5)"><image width="127" height="69" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAH8AAABFCAYAAABjXDnYAAAC20lEQVR4Xu2b0W0UMRiEJxVA3ngDKiBUAHQAFQAVoFSQpAKUCoAO6ACoAKgA6AAeeQKNZEur5C5RbuN/LN3np+S065mdz/96984+EG1vEzjY2yvnwgX8PR4Em+A/lfRkjzMZcenfJP2W9GVE57v2uQn+qaSTXTvkvGsT+CjpXNLna48cfMC2ynf1024ngSNJdzfcTT0IXrc7wu0o3bAX5vwbBrby8AeS3i8GgqeDZ6kBAPyVNHc8/XkbBHck+Q7wYsd+Vp0G/FXxrTr5laR3rQdXf/kzAPBX8Vt9soH7zeqDJA+G0gb80rgviflh8Gub8w+rrQC/OvHLev/aR48l+QGwrAG/LOqtQgb+qD31l877wM/D7/O+3/n9GljWgF8W9Vah/o3qmST/XdaAXxY18PNRz+eAyp+PSZkj4JdFPZ8Q8OdjUuYI+GVRzycE/PmYlDkCflnU8wkBfz4mZY6AXxb1fELAn49JmSPgl0U9nxDw52NS5gj4ZVHPJwT8+ZgMc+SlW28l/Wrr9i7C9+/7PyQdj17SzU+6wxhv7dhr9w3X7WEbAN4h5d/zDf6TpD+SfJy3eA1rwB8W7ZUde8XOy7Zq92fbHmf4fZ9kycIO4GfgL6vf+/betIHgAVFS9b5s4GfgW7VX//e2gNPPAPfb7b9kORfwc/CX1d9dlFU9lZ8D35V79ff/S+b6LkblZwfAsvr/Sro3+gl/ebnAz8Jfzv2lVc9tPw/eDlz93rUz/L3+4uVS+XMMAH/rV7pPj8qfA3zMBZUfiz4vDPw8g5gD4MeizwsDP88g5gD4sejzwsDPM4g5AH4s+rww8PMMYg6AH4s+Lwz8PIOYA+DHos8LAz/PIOYA+LHo88LAzzOIOQB+LPq8MPDzDGIOgB+LPi8M/DyDmAPgx6LPCwM/zyDmAPix6PPCwM8ziDkAfiz6vDDw8wxiDoAfiz4vDPw8g5gD4MeizwsDP88g5uA/Wr5gRic8c/oAAAAASUVORK5CYII=" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,268,188)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 73 0 L 73 14 L 0 14 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="73" height="14"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 73 0 L 73 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="73" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 70 0 L 70 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="67" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 70 0 L 70 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="67" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">"/</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="10" y="12">deploy</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="49" y="12">foo</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="66" y="12">"</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,300.9,350)"><g><g transform="translate(0,0) scale(0.9,0.6)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(1.1111111111111112,1.6666666666666667)"><path fill="none" stroke="none" d="M 0 0 L 90 0 Q 90 0 90 0 L 90 60 Q 90 60 90 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 90 0 Q 90 0 90 0 L 90 60 Q 90 60 90 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,311,366)"><g transform="translate(30,42) matrix(1,0,0,1,0,0) translate(-30,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="28" fill-opacity="0"/></g></g><g transform="translate(30,42) matrix(1,0,0,1,0,0) translate(-30,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(30,42) matrix(1,0,0,1,0,0) translate(-30,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="14" y="0" width="44" height="14" fill-opacity="0"/></g></g><g transform="translate(30,42) matrix(1,0,0,1,0,0) translate(-30,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="14" y="0" width="44" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="14" y="12">Amazon</text></g><g transform="translate(30,42) matrix(1,0,0,1,0,0) translate(-30,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(30,42) matrix(1,0,0,1,0,0) translate(-30,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="1" y="14" width="70" height="14" fill-opacity="0"/></g></g><g transform="translate(30,42) matrix(1,0,0,1,0,0) translate(-30,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="1" y="14" width="70" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="1" y="26">API</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="23" y="26">Gateway</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,185.9,350)"><g><g transform="translate(0,0) scale(0.9,0.6)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(1.1111111111111112,1.6666666666666667)"><path fill="none" stroke="none" d="M 0 0 L 90 0 Q 90 0 90 0 L 90 60 Q 90 60 90 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 90 0 Q 90 0 90 0 L 90 60 Q 90 60 90 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,196,359)"><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="42" fill-opacity="0"/></g></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="5" y="0" width="61" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="5" y="12">deployhook</text></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g/></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g/></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="71" height="28" fill-opacity="0"/></g></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="12" y="14" width="48" height="28" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="12" y="26">(</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="16" y="26">Amazon</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="12" y="40">Lambda</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="55" y="40">)</text></g></g><g transform="matrix(1,0,0,1,315.9,265.5)"><image width="60" height="114" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAByCAYAAAAPrrJuAAAB4UlEQVR4Xu2cwU0DQRRDnQqgBDoBSqATOgA6oBNKADqhBKgA9KVZaTT3eV9i314SJdJafvY4Oe0lJ7suJ/MbDf/3xLsSfh5gj1eMc5fh3+EQ18cFh1ENU502YYi0lYZAt/3xMGET3kTAld4Edr2tZxgC7UpToK00RdqVhkhbaQi0K02BttIUaVcaIm2lIdCuNAXaSlOkXWmItJWGQLvSFGgrTZF2pSHSVhoC7UpToK00RdqVhkhbaQi0K02BttIUaVcaIm2lIdCuNAXaSlOkXWmItJWGQLvSFGgrTZF2pSHSVhoC7UpToK00RdqVhkhbaQi0K02BPkWlr5N8D6Kr4fm7rdCplX5M8pTkIclHktnwXZK3JC9JXre6TbAzXI+vKMNl9n4xXJ/dDsPbH3NBJVyV/UpyNQy/jyTLfL3/SXIzVX5b0JThMjCnXDWu65NMtwRJw3PKc4JYurThOeXZcI3V9rN7CJIJl+aaMppuR8Jrymi6XYaPlEsfWeb5/NCVPrRP93ipSrmu46/mtt/d9cZdCWMGNdyGuknYSjeBx2RNGEPdJGTCTeAxWRPGUDcJmXATeEzWhDHUTUIm3AQekzVhDHWTkAk3gcdkTRhD3SRkwk3gMVkTxlA3CZlwE3hM9g/3nGlzAC7xhQAAAABJRU5ErkJggg==" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,301,299)"><g transform="translate(3,0) matrix(1,0,0,1,0,0) translate(-3,0)"><path fill="none" stroke="none" d="M 0 0 L 90 0 L 90 14 L 0 14 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="90" height="14"/></g></g><g transform="translate(3,0) matrix(1,0,0,1,0,0) translate(-3,0)"><path fill="none" stroke="none" d="M 0 0 L 90 0 L 90 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="90" height="14" fill-opacity="0"/></g></g><g transform="translate(3,0) matrix(1,0,0,1,0,0) translate(-3,0)"><path fill="none" stroke="none" d="M 3 0 L 87 0 L 87 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="84" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">POST</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="39" y="12">webhook</text></g></g><g transform="matrix(1,0,0,1,200.9,305.5)"><image width="149" height="149" preserveAspectRatio="none" xlink:href="data:image/png;base64,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" transform="translate(0,0)"/></g><g transform="translate(0,0) matrix(1,0,0,1,62.95000000000002,350)"><g><g transform="translate(0,0) scale(0.9,0.6)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(1.1111111111111112,1.6666666666666667)"><path fill="none" stroke="none" d="M 0 0 L 90 0 Q 90 0 90 0 L 90 60 Q 90 60 90 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 90 0 Q 90 0 90 0 L 90 60 Q 90 60 90 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,73,359)"><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="42" fill-opacity="0"/></g></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="18" y="0" width="35" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="18" y="12">deploy</text></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g/></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g/></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="71" height="28" fill-opacity="0"/></g></g><g transform="translate(83,28) matrix(1,0,0,1,0,0) translate(-83,-28)"><g><rect fill="rgb(0,0,0)" stroke="none" x="12" y="14" width="48" height="28" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="12" y="26">(</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="16" y="26">Amazon</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="12" y="40">Lambda</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="55" y="40">)</text></g></g><g transform="matrix(1,0,0,1,77.95000000000002,305.5)"><image width="157" height="149" preserveAspectRatio="none" xlink:href="data:image/png;base64,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" transform="translate(0,0)"/></g><g transform="translate(0,0) matrix(1,0,0,1,62.95000000000002,465)"><g><g transform="translate(0,0) scale(0.9,0.5)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(1.1111111111111112,2)"><path fill="none" stroke="none" d="M 0 0 L 90 0 Q 90 0 90 0 L 90 50 Q 90 50 90 50 L 0 50 Q 0 50 0 50 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 90 0 Q 90 0 90 0 L 90 50 Q 90 50 90 50 L 0 50 Q 0 50 0 50 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,73,476)"><g transform="translate(0,0) matrix(1,0,0,1,0,0) translate(0,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="28" fill-opacity="0"/></g></g><g transform="translate(0,0) matrix(1,0,0,1,0,0) translate(0,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(0,0) matrix(1,0,0,1,0,0) translate(0,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="14" fill-opacity="0"/></g></g><g transform="translate(0,0) matrix(1,0,0,1,0,0) translate(0,0)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="71" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="0" y="12">Amazon</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="48" y="12">EC2</text></g></g><g transform="matrix(1,0,0,1,77.95000000000002,405.5)"><image width="60" height="89" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAABZCAYAAABixUebAAABqElEQVR4Xu2bwU3DUBAFXyogJdAJUEI6oQOgAzqhhEAnlAAVgFb6lr4scfyzEh5fEiVSXt7MeuODc8rBjtPB+sbC/914l+HnAXZ7xDh3Ff4ZDfF8PHAUtTA10xqGSDvSEOi2Cw8Na3gRAbf0IrD7j/UchkC7pSnQjjRF2i0NkXakIdBuaQq0I02RdktDpB1pCLRbmgLtSFOk3dIQaUcaAu2WpkA70hRptzRE2pGGQLulKdCONEXaLQ2RdqQh0G7plaDPSb7+uBNvfm/ld8AMPyZ5SnJJ8p5kPofvk7wleUnyurRtghWuu2arcJV92BWu1+5G4eV311I/SzWyn0luRuHrMFnl6/l3kttp5JeJpgpXgdlyjXEdH6TdCiQLz5Zng5hduvBseS5cy2r5ubsFkoYrc28ZtdtheG8ZtdtVeLNc+chmns8feqS37MP9q6Us17Fdai773d1/cJdhrKCF21A3BTvSTeCxWA1jqJuCNNwEHovVMIa6KUjDTeCxWA1jqJuCNNwEHovVMIa6KUjDTeCxWA1jqJuCNNwEHovVMIa6KUjDTeCx2F8/RVBaFHEn9AAAAABJRU5ErkJggg==" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,70,425)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 76 0 L 76 14 L 0 14 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="76" height="14"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 76 0 L 76 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="76" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 73 0 L 73 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="70" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 73 0 L 73 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="70" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">Run</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="28" y="12">instance</text></g></g><g transform="translate(0,0) matrix(1,0,0,1,193.39999999999998,530)"><g><g transform="translate(0,0) scale(1.35,0.6)"><g><path fill="#FFFFFF" stroke="none" d="M 0 0 L 100 0 Q 100 0 100 0 L 100 100 Q 100 100 100 100 L 0 100 Q 0 100 0 100 L 0 0 Q 0 0 0 0 Z"/><g transform="scale(0.7407407407407407,1.6666666666666667)"><path fill="none" stroke="none" d="M 0 0 L 135 0 Q 135 0 135 0 L 135 60 Q 135 60 135 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z"/><path fill="none" stroke="#333333" d="M 0 0 M 0 0 L 135 0 Q 135 0 135 0 L 135 60 Q 135 60 135 60 L 0 60 Q 0 60 0 60 L 0 0 Q 0 0 0 0 Z" stroke-miterlimit="10" stroke-width="2"/></g></g></g></g></g><g transform="matrix(1,0,0,1,204,546)"><g transform="translate(134,42) matrix(1,0,0,1,0,0) translate(-134,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="115" height="28" fill-opacity="0"/></g></g><g transform="translate(134,42) matrix(1,0,0,1,0,0) translate(-134,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="115" height="14" fill-opacity="0"/></g></g><g transform="translate(134,42) matrix(1,0,0,1,0,0) translate(-134,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="32" y="0" width="51" height="14" fill-opacity="0"/></g></g><g transform="translate(134,42) matrix(1,0,0,1,0,0) translate(-134,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="32" y="0" width="51" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="32" y="12">New</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="59" y="12">EC2</text></g><g transform="translate(134,42) matrix(1,0,0,1,0,0) translate(-134,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="14" width="115" height="14" fill-opacity="0"/></g></g><g transform="translate(134,42) matrix(1,0,0,1,0,0) translate(-134,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="35" y="14" width="45" height="14" fill-opacity="0"/></g></g><g transform="translate(134,42) matrix(1,0,0,1,0,0) translate(-134,-42)"><g><rect fill="rgb(0,0,0)" stroke="none" x="35" y="14" width="45" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="35" y="26">instance</text></g></g><g transform="matrix(1,0,0,1,43,230.5)"><image width="180" height="359" preserveAspectRatio="none" xlink:href="data:image/png;base64,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" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,47,553)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 110 0 L 110 14 L 0 14 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="110" height="14"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 110 0 L 110 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="110" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 107 0 L 107 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="104" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 107 0 L 107 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="104" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">Fetch</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="36" y="12">build</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="65" y="12">artifacts</text></g></g><g transform="matrix(1,0,0,1,181.9,220)"><image width="60" height="134" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAACGCAYAAACBrelhAAACJ0lEQVR4Xu2bUU1EMRREBwWAAyTgAFAAEpCAA8ABUkABSMEBoABykzZ5eXy/06Q9+/V2N9lmzkyn/bh7ksVeJ4vpjYJnd1yHdXgyAkZ6MkP/ydFhHZ6MgJGezFBLy0gb6ckIGOnJDLWljbSRnoyAkZ7MUFvaSBvpyQiMivR14/hB8xwluIT+JrlZQXC5+96ElmDU5REOl8CrTaRRl2nBW3d7mlGXacFbd7vg+gxzmRTc3f1JctrU9mfMZVJwd/c5yWMT3J8xlynBW3cvknw1wedJPpvjiMuU4Nckt0nK0ad2BpfmWr/el+NvSe6OPpcpwWdJHpK8JPneCd5/d6hmSvBeRN2yusOHCtz/uIIh3DoMgR42eqjDOnwQAVv6ILCew148oGi5hyHQnsMQaG9aFGgjTZG2pSHSRhoCbUtToI00RdqWhkgbaQi0LU2BNtIUaVsaIm2kIdC2NAV6uUjX2EONLuGliS/YItRHmPD18QVXFdzHmHDg+ILN4ZrNqgG1e6ol+zqjBJfQmtu6XEXwsqVVs5Z1RGGvUZHuDiMDpVuaCoaypcMQaP4uu7tpuYePdtrSOpqwkV7gr3hlsscStJU8lijQRpoi7TkMkTbSEGhbmgJtpCnStjRE2khDoG1pCrSRpkjb0hBpIw2BtqUp0EaaIm1LQ6SNNATalqZAG2mKtC0NkTbSEGhbmgJtpCnStjRE2khDoIe1NKXv3zqj9rCCKQLLOfwHkwmrhzHcYIgAAAAASUVORK5CYII=" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,185,282)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 55 0 L 55 14 L 0 14 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="55" height="14"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 55 0 L 55 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="55" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 52 0 L 52 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="49" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 52 0 L 52 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="49" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">"</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="7" y="12">running</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="48" y="12">"</text></g></g><g transform="matrix(1,0,0,1,84.81038969321074,210)"><image width="148" height="144" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJQAAACQCAYAAADurULCAAADm0lEQVR4Xu3Y0W3TYBiG0a8bsAGMwAhsgNiATYAJGAHYgA2ADWACYANGQL/kSlFoWpo+anxxLOUCtXljPTm4Tq7GoUBY4CrcMqXAAAVBWgCoNKcxoBhICwCV5jQGFANpAaDSnMaAYiAtAFSa0xhQDKQFgEpzGgOKgbQAUGlOY0AxkBYAKs1pDCgG0gJApTmNAcVAWgCoNKcxoBhICwCV5jQGFANpAaDSnMaAYiAtAFSa81HGvs7Mh5n59Civds8XAeqewS786683TOs0fs3M273BAurCQs54+YVqQXq6PXdXsIA64x3dyVN2Cet/QT2fmZcz82JmnszM+rdjnwUuesW6C9SC836DtM98zuq4wLftT+K6eX/04zZQ65K6MK0r0jrWp4rv22P9L1gPx+UKrPfnzcw8207hopCuM5wCtf60fTk40XXyAF0Oz+Er7xLSbaDWFenndmV6t10+95HSWRx+bbCLK9LxW3LTFWp9JF2X0t/bzfcf7+OuCnycmfW4yD3SXSVuArWuTuvv8quZ+XzXgJ8rcFjgGNSCtECt465PgEoq8E+BYzTXN+M/fNdEyzkFjkFd3z+tG76Fy6HAvQqcAuXT3b0y+uVTXxtcX6GAYuSsAq5QZ2XzpFMFgGIjLQBUmtMYUAykBYBKcxoDioG0AFBpTmNAMZAWACrNaQwoBtICQKU5jQHFQFoAqDSnMaAYSAsAleY0BhQDaQGg0pzGgGIgLQBUmtMYUAykBYBKcxoDioG0AFBpTmNAMZAWACrNaQwoBtICQKU5jQHFQFoAqDSnMaAYSAsAleY0BhQDaQGg0pzGgGIgLQBUmtMYUAykBYBKcxoDioG0AFBpTmNAMZAWACrNaQwoBtICQKU5jQHFQFoAqDSnMaAYSAsAleY0BhQDaQGg0pzGgGIgLQBUmtMYUAykBYBKcxoDioG0AFBpTmNAMZAWACrNaQwoBtICQKU5jQHFQFoAqDSnMaAYSAsAleY0BhQDaQGg0pzGgGIgLQBUmtMYUAykBYBKcxoDioG0AFBpTmNAMZAWACrNaQwoBtICQKU5jQHFQFoAqDSnMaAYSAsAleY0BhQDaQGg0pzGgGIgLQBUmtMYUAykBYBKcxoDioG0AFBpTmNAMZAWACrNaQwoBtICQKU5jQHFQFoAqDSnMaAYSAsAleY0BhQDaQGg0pzGgGIgLQBUmtPYMShFFHhQAaAelM+TjwsAxURaAKg0p7G/tmX6kUR6s8kAAAAASUVORK5CYII=" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,120,233)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 53 0 L 53 14 L 0 14 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="53" height="14"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 53 0 L 53 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="53" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 50 0 L 50 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="47" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 50 0 L 50 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="47" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">app</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="26" y="12">URL</text></g></g><g transform="matrix(1,0,0,1,148.45000000000002,485.5)"><image width="142" height="74" preserveAspectRatio="none" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAI4AAABKCAYAAABthGyqAAADFklEQVR4Xu2cUY4NYRSEa1aAN29YAVaAHbACrECsACsQK8AO7AArwAqwAx49kZN0JzeTkdz0TFVT+fppHqZP3VP15fR/O/f/T8SFAxscONlwD7fggAAHCDY5cBY4dyXd2VSNmxwOfJb0Q9JHR/GtNc8C57mkZ1sLcp/VgXeSXkn6YFU5ovjfJs5MHa79Hbgl6fIZT4AB6PEyiXb5lKxxdrF9k+h1SW8OIJpH2L294AGcTRnuetP9BaBLkmbyPNjj0wDOHq6fX/ORpNdLmZk68TUP4Jw/xL0qDCzz7fetpAEpegFO1O4LFZuF86dljXPlQisfUQxwjjDpH/6X38tnuy1pFsuxC3BiVluEBpaby7er6DoHcCx5xoqu65x5pzNf1WMX4MSstgitb/lfSJq/YxfgxKy2CAGOxdb+ooDTn7GlQ8Cx2NpfFHD6M7Z0CDgWW/uLAk5/xpYOAcdia39RwOnP2NIh4Fhs7S8KOP0ZWzoEHIut/UUBpz9jS4eAY7G1vyjg9Gds6RBwLLb2FwWc/owtHQKOxdb+ooDTn7GlQ8Cx2NpXdPZSvZT0fdmEdxqc+fH6V0lP3XvK+c3x/wXXHDwwYMx1Y4FnjqSZH6sPNO8l/ZQ0/zdn6tguwLFZays822AeLlt/vy1nGQ0464FYkR0PgGPL11b4cOrMIUtPFogGpsi0mc4Ax5avtfA6db4sOzlnzXNteWRF9lcBjjVfW/HDqbOKxKYNE8eWa6TwOnVWscjaZhVj4kQytogcTp1fkq66v0kddgE4lkxjRdepE502PKpi+dqEZurMUSf29zanO2Di2DKNFZ63ydFDlZg4sWz7hJg4fZlGOgKciM19IoDTl2mkI8CJ2NwnAjh9mUY6ApyIzX0igNOXaaQjwInY3CcCOH2ZRjoCnIjNfSKA05dppCPAidjcJwI4fZlGOgKciM19IoDTl2mkI8CJ2NwnAjh9mUY6ApyIzX0igNOXaaQjwInY3CcCOH2ZRjoCnIjNfSKA05dppCPAidjcJwI4fZlGOgKciM19IoDTl2mkI8CJ2Nwn8geh8GpLt5DP9gAAAABJRU5ErkJggg==" transform="translate(0,0)"/></g><g transform="matrix(1,0,0,1,169,483)"><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 87 0 L 87 14 L 0 14 Z"/><g><rect fill="rgb(255, 255, 255)" stroke="none" x="0" y="0" width="87" height="14"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 0 0 L 87 0 L 87 14 L 0 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="0" y="0" width="87" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 84 0 L 84 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="81" height="14" fill-opacity="0"/></g></g><g transform="translate(6,0) matrix(1,0,0,1,0,0) translate(-6,0)"><path fill="none" stroke="none" d="M 3 0 L 84 0 L 84 14 L 3 14 Z"/><g><rect fill="rgb(0,0,0)" stroke="none" x="3" y="0" width="81" height="14" fill-opacity="0"/></g><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="3" y="12">create</text><text fill="rgb(0, 0, 0)" stroke="none" font-family="Arial" font-size="12px" font-style="normal" font-weight="normal" text-decoration="" line-height="14px" x="39" y="12">instance</text></g></g></g></svg>

## Along comes AWS

We are using the excellent [Travis CI](https://travis-ci.org/) for building our project and
running the automated test suites. We had the idea that we could automatically push the build
artifacts to S3 so that the latest build of a branch (along with a database dump) is always
available for deployment. Luckily Travis has direct support for S3 so the configuration is
a simple snippet in `.travis.yml` file:

```yml
deploy:
  provider: s3
  region: eu-central-1
  skip_cleanup: true
  bucket: "harjatravis"
  acl: public_read
  local_dir: s3-deploy
  on:
    all_branches: true
```

This instructs Travis to push all branches to our bucket. We set the bucket configuration
to automatically expire the artifacts after 2 weeks so that we don't accumulate old builds
for too long. Our build yields two artifacts: the production build .jar file and a PostgreSQL
dump of the test data that has been migrated to the latest version. Both are uploaded with
the branch name as part of the file name. Our branch names are usually the same as the JIRA
issue number so they are predictable.

## Setting up the build environment

Next we had to set up the actual machine for running the builds. We started with a
[CentOS](https://www.centos.org/) Linux image and started a new EC2 instance from it.
We then provisioned it with all the pieces needed to run the builds with
[Ansible](https://www.ansible.com). This includes installing NGINX, Java, PostgreSQL and
some shell scripts to start our service. Normally a production environment wouldn't have
the front-end proxy, the application service and the database on the same machine but for
testing purposes it will suffice.

After the machine had everything we need, we stopped it and created a new AMI from it to
use as a template for a deployed build.

## A serverless solution for starting up servers

Next we needed some way to easily start new EC2 machines for builds. AWS Lambda provides
a nice way to run predefined code and hook it up to services.

Lambda is described as a "serverless" solution for building applications and has a pay-per-execution
billing model. In our case, we are using Lambda to start new servers, so I guess the serverless
term doesn't really apply here.

We used Python as it can be easily edited right from the AWS Lambda console and has a good library
for using AWS services programmatically available. The library is called
[boto3](https://github.com/boto/boto3) and it can be used with zero configuration
from Lambda Python code.

```python
# coding=utf-8
import os
import boto3
import urllib2
import time
import ssl

initscript = '''...cloud config script here...'''

def check_branch(branch):
    req = urllib2.Request('...our deployment s3 bucket public url.../harja-travis-' + branch + '.jar')
    req.get_method = lambda: 'HEAD'
    try:
        res = urllib2.urlopen(req)
        if res.getcode() == 200:
            return True
    except:
        pass
    return False

def deploy(branch):
    script = initscript.replace('$BRANCH',branch)
    ec2 = boto3.client('ec2',region_name='eu-central-1')
    res = ec2.run_instances(ImageId='...ami-id...',
                            InstanceType='t2.medium',
                            UserData=script,
                            KeyName='...keypair...',
                            MinCount=1,
                            MaxCount=1)
    id = res['Instances'][0]['InstanceId']
    host = None
    while host is None:
        time.sleep(2)
        instances = ec2.describe_instances(InstanceIds=[id])
        for r in instances['Reservations']:
            for i in r['Instances']:
                dns = i['PublicDnsName']
                if dns != '':
                    host = dns
    return host

def wait_for_url(url):
    ctx = ssl.create_default_context()
    ctx.check_hostname = False
    ctx.verify_mode = ssl.CERT_NONE
    status = None
    while status != 200:
        time.sleep(2)
        try:
            status = urllib2.urlopen(url, context=ctx).getcode()
        except:
            pass

def lambda_handler(event, context):
    branch = event['branch']
    txt = None
    if check_branch(branch):
        host = deploy(branch)
        url = 'https://' + host + '/'
        wait_for_url(url)
        txt = 'Started ' + branch + ': ' + url;
    else:
        txt = 'No Travis build for branch: ' + branch + '. Check build.'
    try:
        payload = '{"text": "'+txt+'"}'
        urllib2.urlopen(event['response_url'], payload)
    except Exception, e:
        print 'error sending Slack response: ' + str(e)
```

The above script does quite a lot. It takes an event that has two fields: branch and
response_url. The branch is the name of the git branch to deploy and response_url is
the Slack webhook URL to send a message to when the build is ready.

First the branch is checked by doing a HEAD request for the build artifact. If it doesn't exist,
bail out and notify the user that the build cannot be found.

If the build is ok, start a new EC2 instance for it from our previously created AMI and pass it a
user data cloud init script. More on cloud init later.
After the machine has been started we repeatedly call describe until the machine has a public
network name and return it.

Finally, we wait for the machine to be actually up and running the software before
notifying the user with a URL to the new machine. Running status is determined simply
by doing an HTTP GET request to it (with fake SSL, because we don't use real certificates
for the ephemeral test machines).

## Cloud init

[Cloud init](https://cloud-init.io/) is a simple way to customize servers that have been cloned from
a template. With EC2 Centos images, we can provide a cloud init script with the instance user data.

Cloud init is a YAML configuration file which can do lots of different customization tasks on the
starting instance. In our case, we only need to run some shell commands:

```yaml
#cloud-config
runcmd:
  - echo "Start PostgreSQL 9.5";
  - sudo service postgresql-9.5 start;
  - sudo -u postgres psql -c 'create database harja;';
  - sudo wget https://...s3 bucket url.../harja-travis-$BRANCH.pgdump.gz;
  - sudo wget https://...s3 bucket url.../harja-travis-$BRANCH.jar;
  - sudo zcat harja-travis-$BRANCH.pgdump.gz | sudo -u postgres psql harja;
  - sudo service nginx start
  - /home/centos/harja.sh $BRANCH
```

We start up PostgreSQL, create the database and restore it from the downloaded dump
and start nginx and our application service from a downloaded .jar file.

The above script is included in the Python lambda script and the `$BRANCH` is replaced with the
actual branch name parameter.

## Adding the chat interface

We use [Slack](https://slack.com/) as our company wide chat and all our tools report to our project
channel. We already have GitHub and CI notifications and error logging going to Slack so it makes
sense to also have our test builds triggered from there.

Slack makes it easy to create your own applications and uses webhooks for integrating with external
services. So we made our custom slack app and added a slash command "/harjadeploy" which calls an
AWS Lambda service.

Unfortunately, this stage was somewhat trickier as Slack webhook POST calls use HTML form
encoding to deliver values and AWS API gateway only accepts JSON input.
Slack slash commands also have only three seconds to respond before they time out and
deployments take much longer than that so we can't use the previous deployment Lambda
directly.

The first problem was solved by a quick search. Other people have had the same problem and we found
a [gist on GitHub](https://gist.githubusercontent.com/ryanray/668022ad2432e38493df/raw/a3b8c765791ac6cfc15811a5dcb2d97056adc107/aws-api-gateway-form-to-json.ftl)
to convert FORM encoded data to JSON.

The second problem required adding another Lambda function which responds to the Slack
slash command. That Lambda then asynchronously calls our deployment Lambda passing it
the branch and the response URL. This provided a good way to separate the Slack webhook
processing from the actual deployment.

```python
# coding=utf-8
import os
import boto3

def deploy(branch, response_url):
    lam = boto3.client('lambda',region_name='eu-central-1')
    lam.invoke(FunctionName='deployasync',
               InvocationType='Event',
               Payload=b'{"branch": "'+branch+'", "response_url": "'+response_url+'"}')

def lambda_handler(event, context):
    token = os.environ['slacktoken']
    user = event['user_name']
    allowed = os.environ['allowed_users'].split(',')
    if not user in allowed:
        return {'text': 'You are not on the allowed user list.'}
    else:
        try:
          if event['token'] == token:
            deploy(event['text'], event['response_url'])
            return {'text': 'Starting branch: ' + event['text'] + '. Please wait.'}
        except Exception, e:
            return "error: " + str(e)
```

This Lambda function is much simpler. It simply checks that the webhook call is coming from Slack
by comparing an environment variable to an event field. Then we check that the Slack
user name is on a list of allowed users.

If the invocation is valid, fire up an asynchronous invocation of the previously defined
deployment Lambda and return a message to the user.


## Finishing touches and the final result

Now that we have a way to easily start new application instances from the comfort
of our chat room, we have one final thing to consider: termination.
We are starting up new servers easily but we have no way of terminating them. We certainly
don't want to do that by hand and we can't leave them running forever and costing us
money.

We decided on a very simple solution that fits our working patterns quite well: a cron job.
We set up a third Lambda function that is run every evening a few hours after business
hours and its only job is to terminate all running EC2 instances.
We don't have anything besides our test environments in this AWS account so we can
safely indiscriminately terminate all running instances.

```python
def lambda_handler(event, context):
    ec2 = boto3.client('ec2', region_name='eu-central-1')
    instances = ec2.describe_instances()
    ids = []
    for r in instances['Reservations']:
        for i in r['Instances']:
            ids.append(i['InstanceId'])
    ec2.terminate_instances(InstanceIds=ids)
    return 'Terminated instances: ' + str(ids)
```

Conveniently AWS CloudWatch supports cron-like expressions for scheduled events so we
triggered it to run every night at 19:00.

We now can easily start up new test environments and don't need to worry about terminating
them. The whole system has a lot of moving parts but all the complexity is hidden
behind the simple chat interface.
The final result in all its simplicity looks like this:

![slack-deploy](/img/slack-deploy.gif)
